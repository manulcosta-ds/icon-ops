# Icon Guardian - File Structure

Complete overview of all files in the Icon Guardian plugin.

```
icon-guardian/
├── Configuration Files
│   ├── manifest.json           # Figma plugin manifest (required by Figma)
│   ├── package.json            # NPM dependencies and scripts
│   ├── tsconfig.json           # TypeScript compiler configuration
│   ├── vite.config.ts          # Vite bundler configuration
│   └── .gitignore              # Git ignore patterns
│
├── Documentation
│   ├── README.md               # Main documentation with full features
│   ├── QUICKSTART.md           # 5-minute setup guide
│   ├── LIMITATIONS.md          # Implementation notes and limitations
│   └── FILE_STRUCTURE.md       # This file
│
├── Source Code (src/)
│   │
│   ├── Main Plugin Code
│   │   ├── main.ts             # Plugin main thread (runs in Figma sandbox)
│   │   │                       # - Handles all plugin logic
│   │   │                       # - Communicates with UI via postMessage
│   │   │                       # - Imports, audits, fixes
│   │   │
│   │   └── types.ts            # TypeScript type definitions
│   │                           # - ImportOptions
│   │                           # - StyleVariantInfo
│   │                           # - AuditIssue, AuditReport
│   │                           # - DuplicateGroup, FixAction
│   │
│   ├── User Interface
│   │   ├── ui.html             # HTML structure
│   │   │                       # - Home screen
│   │   │                       # - Import screen
│   │   │                       # - Audit screen
│   │   │                       # - Modals and viewers
│   │   │
│   │   ├── ui.ts               # UI logic and state management
│   │   │                       # - Screen navigation
│   │   │                       # - Form handling
│   │   │                       # - Issue rendering
│   │   │                       # - Message handling from plugin
│   │   │
│   │   └── styles.css          # Complete styling
│   │                           # - Component styles
│   │                           # - Layout system
│   │                           # - Modal and viewer styles
│   │                           # - Responsive design
│   │
│   └── Utility Modules (utils/)
│       │
│       ├── svg-parser.ts       # ZIP and SVG processing
│       │                       # - extractSVGsFromZip()
│       │                       # - parseIconNameAndStyle()
│       │                       # - groupByBaseIcon()
│       │                       # - assignStyleNames()
│       │                       # - sanitizeName()
│       │
│       ├── variant-utils.ts    # Component Set creation
│       │                       # - createComponentFromSVG()
│       │                       # - createComponentSet()
│       │                       # - createSingleComponent()
│       │                       # - layoutComponentsInGrid()
│       │
│       ├── layout-utils.ts     # Frame and node layout
│       │                       # - createImportFrame()
│       │                       # - layoutComponentsInFrame()
│       │                       # - createAuditFrame()
│       │                       # - getNodesForAudit()
│       │
│       ├── audit-engine.ts     # All audit checks
│       │                       # - runAudit()
│       │                       # - findDuplicates()
│       │                       # - checkStrokeThickness()
│       │                       # - checkFillPolicy()
│       │                       # - checkGeometry()
│       │                       # - checkNaming()
│       │                       # - getNodeSignature()
│       │
│       └── fix-engine.ts       # Fix operations
│                               # - applyFixes()
│                               # - fixDuplicates()
│                               # - fixStrokeThickness()
│                               # - fixFillPolicy()
│                               # - fixGeometry()
│                               # - fixNaming()
│                               # - generateFixPreview()
│
└── Build Output (dist/) - Generated by build process
    ├── main.js                 # Bundled plugin code
    └── ui.html                 # Bundled UI (inline CSS/JS)
```

## File Responsibilities

### Configuration Layer

**manifest.json**
- Defines plugin metadata for Figma
- Specifies entry points (main.js, ui.html)
- Sets permissions and network access
- Required for Figma to recognize the plugin

**package.json**
- Lists dependencies (jszip, vite, typescript, etc.)
- Defines build scripts (build, watch)
- Manages devDependencies

**tsconfig.json**
- TypeScript compiler settings
- Target ES2020
- Strict type checking enabled
- Module resolution configuration

**vite.config.ts**
- Bundler configuration
- Single-file output for UI
- Entry points for main and UI
- Plugin setup (vite-plugin-singlefile)

### Core Plugin Logic

**main.ts** (320 lines)
- Message handler: Receives commands from UI
- Import orchestration: Manages ZIP import workflow
- Audit coordination: Runs audit checks
- Fix application: Applies selected fixes
- Node operations: Zoom, select, manipulate Figma nodes

**types.ts** (50 lines)
- Central type definitions
- Ensures type safety across modules
- Documents data structures

### User Interface

**ui.html** (220 lines)
- Semantic HTML structure
- Screen components (home, import, audit)
- Modal dialogs
- Form inputs
- Results display

**ui.ts** (450 lines)
- State management (current report, selections)
- Event handlers (buttons, inputs, filters)
- Rendering functions (issues, stats, duplicates)
- Message passing to plugin
- UI updates based on plugin responses

**styles.css** (520 lines)
- Complete visual design
- Responsive layouts
- Component-based styling
- Modal and overlay styles
- Color system and typography

### Utility Modules

**svg-parser.ts** (120 lines)
- ZIP decompression with JSZip
- SVG file extraction
- Style detection algorithm
- Name sanitization
- Icon grouping logic

**variant-utils.ts** (95 lines)
- SVG to Figma component conversion
- Component Set creation
- Size scaling logic
- Grid layout within Component Sets
- Variant naming

**layout-utils.ts** (75 lines)
- Frame creation and configuration
- Auto-layout setup (1200px grid)
- Node organization
- Scope-based node selection

**audit-engine.ts** (280 lines)
- Audit orchestration
- Five audit check implementations:
  1. Duplicate detection with hashing
  2. Stroke thickness validation
  3. Fill policy enforcement
  4. Geometry cleanup detection
  5. Naming convention validation
- Issue generation and categorization

**fix-engine.ts** (220 lines)
- Batch fix operations
- Type-specific fix strategies
- Preview generation
- Error handling
- Result reporting

## Code Flow

### Import Flow
```
UI (ui.ts) 
  → User selects ZIP + options
  → Sends to main.ts
    → svg-parser.ts: Extract and parse SVGs
    → variant-utils.ts: Create components
    → layout-utils.ts: Arrange in frame
    → audit-engine.ts: Run automatic audit
  → Results back to UI
```

### Audit Flow
```
UI (ui.ts)
  → User selects scope + options
  → Sends to main.ts
    → layout-utils.ts: Get nodes to audit
    → audit-engine.ts: Run all checks
    → Generate report
  → Results back to UI
    → ui.ts: Render issues, stats, filters
```

### Fix Flow
```
UI (ui.ts)
  → User selects issues
  → Requests preview
    → fix-engine.ts: Generate preview
  → User confirms
    → fix-engine.ts: Apply fixes
    → audit-engine.ts: Re-run audit
  → Updated results to UI
```

## Dependencies

### Runtime Dependencies
- **jszip** (^3.10.1): ZIP file parsing and extraction

### Development Dependencies
- **@figma/plugin-typings** (^1.90.0): Figma API types
- **@types/node** (^20.10.0): Node.js types
- **typescript** (^5.3.3): TypeScript compiler
- **vite** (^5.0.8): Build tool and bundler
- **vite-plugin-singlefile** (^0.13.5): Bundle to single HTML file

## Build Process

1. **TypeScript Compilation**: `.ts` files → JavaScript
2. **Module Bundling**: Combines all modules
3. **Single-file UI**: Inlines CSS and JS into HTML
4. **Output**: 
   - `dist/main.js` (plugin code)
   - `dist/ui.html` (complete UI)

## Development Workflow

1. Make changes to `.ts` or `.css` files
2. Run `npm run watch` (auto-rebuild)
3. Reload plugin in Figma
4. Test changes
5. Repeat

## Plugin Size

Approximate file sizes (after build):
- **main.js**: ~150-200 KB (includes JSZip)
- **ui.html**: ~50-70 KB (includes inline CSS/JS)
- **Total**: ~200-270 KB

Small enough for fast loading, large enough to be feature-rich.

## Extension Points

To add new features:

1. **New audit check**: Add to `audit-engine.ts`
2. **New fix operation**: Add to `fix-engine.ts`
3. **New UI screen**: Add to `ui.html` and `ui.ts`
4. **New import option**: Update `types.ts` and `main.ts`
5. **New style keyword**: Update `STYLE_KEYWORDS` in `svg-parser.ts`

## Testing Strategy

Each module is independently testable:
- `svg-parser.ts`: Unit test with sample ZIPs
- `audit-engine.ts`: Test with mock node structures
- `fix-engine.ts`: Test with sample issues
- `ui.ts`: Test with message events
- Integration: Test full workflows in Figma

## Code Quality

- **Type Safety**: Full TypeScript coverage
- **Modularity**: Single-responsibility modules
- **Error Handling**: Try-catch in async operations
- **User Feedback**: Progress indicators and error messages
- **Documentation**: Inline comments for complex logic
